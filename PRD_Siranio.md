# PRD – 증권사 이상금융거래 탐지 시나리오 자동 생성 시스템(Siranio)

## 1. 제품 개요

- **제품명**: Siranio 이상금융거래 탐지 시나리오 자동 생성 시스템  
- **한 줄 정의**:  
  사용자가 입력한 3개의 이상금융거래 탐지 조건(키워드)을 기반으로, 자동으로 3개의 탐지 시나리오와 해당 시나리오를 실행하는 SQL을 생성하고, 거래이력 테이블에 대해 실행·결과 조회까지 지원하는 시스템.
- **주요 사용자**
  - 증권사 **리스크관리 / 준법감시 / 컴플라이언스 담당자**
  - 이상거래 룰을 관리하는 **리스크 분석가 / 데이터 분석가**
  - 내부 **IT/개발 부서** (룰 운영/관리 지원)

---

## 2. 추진 목적 및 목표

### 2.1 비즈니스 목적

- 사람이 엑셀/쿼리로 직접 작성하던 이상금융거래 탐지 시나리오를 **자동 생성**하여 업무 효율을 높임.
- SQL 작성 역량이 부족한 실무자도 **조건 키워드만 입력**하면 시나리오와 SQL을 얻을 수 있도록 함.
- 새로운 이상거래 패턴에 대한 탐지 시나리오를 **빠르게 설계·실행**함으로써 이상금융거래 대응 민첩성을 확보.

### 2.2 정량적/정성적 목표

- 신규 탐지 시나리오 작성 소요 시간을 **수일 → 1시간 이내**로 단축.
- 리스크/준법 담당자가 **직접 SQL을 쓰지 않고도** 탐지 룰을 설계·등록·실행 가능.
- PoC 단계에서는 **합성 데이터(가상 고객/거래 데이터)**를 기준으로 기능과 탐지 로직을 검증.

---

## 3. 범위(Scope)

### 3.1 포함 범위

1. **입력 화면**
   - 사용자가 이상금융거래 탐지 조건으로 사용할 **3개의 키워드**를 입력하는 화면.
2. **출력 화면 1 – 시나리오·SQL 자동 생성**
   - 입력된 3개 키워드를 기반으로 **3개의 이상금융거래 탐지 시나리오 자동 생성**.
   - 각 시나리오별로:
     - 시나리오 설명(자연어)
     - 조건별 임계값(Threshold)
     - 해당 시나리오를 실행할 수 있는 **SQL 문**을 화면 하단에 표기.
   - 화면 상단/중앙에 **“시나리오 1 ~ 3”** 형태로 블록 구성.
   - 각 시나리오 블록에 **선택 버튼**을 두고, 선택 시 **이상금융거래 탐지 시나리오 테이블에 저장**.
3. **출력 화면 2 – 탐지 결과 조회**
   - 등록된 이상금융거래 탐지 시나리오를 실행하여  
     실제 탐지 결과를 **목록 형태**로 보여주는 화면.
4. **테이블 구조**
   - 고객 정보 테이블
   - 고객 거래 정보 테이블
   - 이상금융거래 탐지 시나리오 테이블
   - 실제 탐지 결과 이력 테이블
5. **합성 데이터 생성**
   - 고객 정보 500건 (0~80세)
   - 고객 거래 정보 10,000건 생성 및 입력

### 3.2 제외(Out of Scope)

- 실제 증권사의 **계정계/계정원장 시스템과의 실시간 연계**.
- 실시간 스트리밍 기반 이상거래 탐지 및 알람 발송.
- 머신러닝/딥러닝 기반 고급 이상거래 탐지 모델.
- 케이스 관리(조사 이력, 메모, 첨부파일, 조사 워크플로우 등).

---

## 4. 주요 기능 요구사항

### FR-01. 조건 입력 화면

- 사용자는 **3개의 이상금융거래 탐지 조건 키워드**를 입력한다.
  - 예: “고액 출금”, “야간”, “젊은 고객”
- 필수 조건:
  - 3개 모두 필수 입력 (공란 허용 불가).
  - 각 키워드 최대 길이(예: 100자).
- [시나리오 생성] 버튼을 제공하며, 클릭 시 백엔드에 조건 전달 및 시나리오 자동 생성 API 호출.

---

### FR-02. 시나리오 및 SQL 자동 생성

- 입력된 3개 키워드를 기반으로 **3개의 후보 시나리오**를 생성한다.
- 각 시나리오에는 다음 정보를 포함한다.
  - 시나리오 이름
  - 시나리오 설명(자연어)
  - 조건 논리 및 임계값(Threshold)
    - 예: 출금금액 > 3,000,000원, 출금 시간 22~06시, 고객 나이 < 30세 등
  - 해당 조건을 만족하는 거래를 조회하는 **SQL 문**
    - 고객 정보 테이블 + 고객 거래 정보 테이블을 조인
- 키워드와 DB 컬럼 간 매핑 규칙(룰/템플릿)을 기반으로 자동 생성:
  - “고액 출금” → WITHDRAWAL_AMOUNT > 임계값
  - “야간” → WITHDRAWAL_TIME between 22:00~06:00
  - “젊은 고객” → CUSTOMER_AGE < 임계값
- 시나리오 3개는 임계값 수준을 **엄격/중간/완화** 등으로 차별화하여 생성.

---

### FR-03. 시나리오 검토 및 저장 (출력 화면 1)

- 화면 구성:
  - 상단: 입력받은 조건 요약(키워드 3개).
  - 본문: **시나리오 1, 2, 3** 각각을 카드 또는 패널 형태로 보여줌.
    - 시나리오 이름
    - 시나리오 설명
    - 조건 및 임계값 목록
    - SQL 문 (읽기 전용 텍스트 영역)
    - [선택 및 저장] 버튼
- [선택 및 저장] 버튼 클릭 시:
  - 해당 시나리오 정보(키워드, 임계값, SQL 등)를  
    **이상금융거래 탐지 시나리오 테이블**에 저장.
  - 시나리오 ID를 발급 및 화면에 성공 메시지 표시.

---

### FR-04. 등록 시나리오 실행 및 결과 조회 (출력 화면 2)

- 화면 구성:
  - 상단/좌측: 등록된 시나리오 목록 (시나리오 ID, 이름, 등록일시 등).
  - 우측/하단: 선택한 시나리오 실행 결과 그리드.
- 기능:
  - 시나리오 목록에서 1개 이상 선택 후 [탐지 실행] 버튼 클릭.
  - 백엔드는 시나리오 테이블에 저장된 SQL을 활용하여  
    고객 거래 정보 테이블에 대해 질의 수행.
  - 탐지된 건에 대해 **실제 탐지 결과 이력 테이블**에 삽입.
  - 결과 그리드에 다음 항목을 기본 표시:
    - 고객 ID
    - 거래번호 (또는 거래 ID)
    - 시나리오 ID
    - (선택) 출금일자, 출금시간, 출금금액, 출금매체

---

### FR-05. 합성 데이터 생성

- 고객 정보 테이블:
  - 고객 수: 500명
  - 나이: 0~80세 범위에서 랜덤 생성
  - 성별: M/F 랜덤
  - 거주지역: 사전에 정의된 지역 코드 또는 지역명 중 랜덤
  - 등록일자: 최근 N년 범위 내 랜덤
- 고객 거래 정보 테이블:
  - 거래 건수: 10,000건
  - 고객 ID: 위에서 생성한 500명의 고객 중 랜덤 선택
  - 출금일자/시간: 최근 1년 이내 랜덤
  - 출금금액: 소액이 다수, 고액이 일부가 되도록 분포 설정
  - 출금매체: ATM, 창구, 인터넷 등 중 랜덤

---

## 5. 비기능 요구사항

- **성능**
  - 시나리오 생성(3개 생성): 정상 기준 3초 이내 응답.
  - 탐지 실행(10,000건 기준): 5초 이내 결과 표출.
- **사용성**
  - 조건 입력 → 시나리오 확인 → 저장 → 실행까지  
    3~4단계 이내에 수행 가능하도록 단순한 플로우.
- **보안**
  - 최소한의 로그인/인증 기능(POC 계정 기반) 적용.
  - DB 접속 정보는 서버 측에서만 관리, 클라이언트로 노출 금지.
- **로그/감사**
  - 시나리오 생성 요청/응답 로그.
  - 시나리오 저장 이력(사용자, 시나리오 ID, 시간).
  - 탐지 실행 이력(사용자, 시나리오 ID, 실행 시간, 탐지 건수).

---

## 6. 화면 구상(개념)

1. **화면 1 – 조건 입력 화면**
   - 필드: [조건 키워드 1], [조건 키워드 2], [조건 키워드 3]
   - 버튼: [시나리오 생성]
2. **화면 2 – 시나리오 검토 및 저장**
   - 3개의 시나리오 카드(시나리오 1~3)
   - 각 카드에 설명, 임계값, SQL, [선택 및 저장] 버튼
3. **화면 3 – 탐지 결과 조회**
   - 상단: 시나리오 리스트 + [탐지 실행] 버튼
   - 하단: 탐지 결과 그리드(고객 ID, 거래번호, 시나리오 ID, 일자, 금액 등)
